# <센서응용 및 시스템>
Atmega128을 사용하여 여러가지 센서의 동작을 학습하고 최종적으로 수행한 텀프로젝트이다.

사용한 센서로는
- 조도센서(Cds Sensor)
- 인체감지센서(PIR Sensor)
- 서보모터

를 사용하였다.

다음은 프로젝트에 대한 설명이다.

1. 시스템 구현 목표

 광량의 정도와 사람을 인식하여 가로등 전등을 3단계로 나누어 점등되게 하여 전력을 아낄 수 있도록 시스템 개발. 추가로 햇빛이 많을 때 햇빛 가림막이 작동하게 하여 그늘을 만들어 줄 수 있도록 하였다. 스마트 가로등에서 범위를 넓혀 스마트 공원적인 느낌을 내고자 하였다. 최근 스마트 가로등이 많이 상용이 되고 있고 IoT를 사용한 다양한 기능들이 추가되어 있다. 스마트 가로등의 기본적인 기능을 구현해보면서 센서에 대한 이해를 높이고 1년 동안 배운 Atmega128의 활용과 동시에 실제적인 작품을 만들어 볼 수 있다. 

- PIR센서를 이용한 사람인식 기능 구현
  - PIR센서를 사용하여 사람을 인식하였다. Atmega128로 입력 값이 들어오도록 설정을 하여 사람이 인식되었을 때 입력 값을 1, 사람이 인식되지 않았을 때의 입력 값을 0으로 주었다. 사람이 인식 여부의 입력 값을 조건문을 통해 조건을 부여하여 프로그램이 돌아갈 수 있도록 프로그램을 작성하였다.
 
- Cds센서를 이용한 광량 파악 기능 구현
  - Cds센서는 Atmega128 내부의 adc기능을 사용하여 구현하였다. adc의 값을 받기 위해서는 두가지 모드가 있다. 단극성 입력 모드와 차동 입력 모드 인데 조도센서 Cds센서의 값을 받아오기 위해서는 단극성 입력 모드를 사용하였다. 조도값을 아날로그 값으로 보드로 받아와 그 값을 조건문을 통해 조건을 부여하여 프로그램이 돌아갈 수 있도록 프로그램을 작성하였다.

- 서보모터를 이용한 햇빛 가림막 기능 구현
  - 햇빛 가림막을 구현하기로 한 이유는 조도센서를 사용하여 낮과 밤을 빛의 양에 따라 구분하여 가로등을 3단계로 구현할 때 폭염 속에 강한 햇빛을 막아줄 수 있는 가림막이 있으면 좋겠다고 생각했기 때문이다. 따라서 기존의 두 서보모터는 90˚, -90˚ 로 유지하고 있는데 코드로 준 조건에 따라 광량이 셀 때 각각 0˚로 작동하게 하였다. 즉, 90˚, -90˚ 일 때는 서로 가림막을 반대방향으로 하고 있다가 각각 0도로 설정이 되면서 그늘이 형성될 수 있다. 조건문 내부에 동작을 수행하는 부분으로 프로그램이 돌아갈 수 있도록 프로그램을 작성하였다.

- 센서융합을 통한 스마트 가로등 구현
  - 우선 전체적인 틀을 생각했을 때 초저녁 정도의 어느 정도 어두움이 있을 때부터 기본적인 밝기가 가로등을 통해 주어져야 한다고 생각을 하였다. 즉, 사람이 인식되지 않아도 가로등이 켜져야 할 어두움이 있으면 항상 켜져 있어야 한다는 것이다. 하지만 제일 먼저 전력을 아끼기 위해 스마트 가로등을 생각한 만큼 사람이 인식되지 않는다면 3단계 중 가장 어두운 밝기인 1단계가 구현이 되어야 한다고 생각했다.
 그리고 어두운 정도에 따라 2단계, 3단계가 구현이 되는데 이 때는 조도센서의 값과 PIR센서의 입력 값 두 가지를 모두 받아와야 구현이 가능하다. 2단계에 진입하는 밝기와 사람이 인식되는 두 가지 조건을 모두 충족하여야 LED 2단계가 구현이 된다. 3단계도 마찬가지로 3단계에 진입하는 밝기와 사람이 인식되는 두 가지 조건을 모두 충족하여야 LED 3단계가 구현이 된다.

- 센서융합을 통한 햇빛 가림막 구현
  - 폭염 때 신호등의 햇빛 가림막에서 영감을 받은 만큼 햇빛이 강할 때 가림막이 작동해야 한다고 생각을 하였다. 때문에 햇빛이 강할 때를 조도센서를 통해 인식을 받고 가림막을 구현하였다. 햇빛의 강렬함을 실내에서 표현을 할 수 없기 때문에 핸드폰 손전등으로 대체하였다.
  
2. H/W 시스템 구성
-블록 다이어그램 및 설명

![image](https://user-images.githubusercontent.com/59470033/76866689-d6281680-68a7-11ea-8e5b-af28891f001a.png)

우선, PC에서 Codevision을 통해 코딩이 된 내용을 컴파일하여 Atmega128에 다운을 한다. 코드에 따라 조도센서와 PIR센서의 값이 Atmega128 MCU에 입력이 된다. 조도센서와 PIR센서를 통해 입력된 값이 MCU로 들어가면 다시 한 번 코드에 따라 서보모터1, 서보모터2에 영향을 주거나 브레드보드로 입력을 주게 되고 LED1, LED2, LED3에 상황에 따라 다르게 입력이 된다.

-사용 센서에 대한 사용 분석 및 고려사항 

①PIR 센서

*사양
1. 허용전압 범위 : DC 4.5 - 20V
2. 정동작 전류 : 50㎂
3. high output level : 3.3V / low : 0V

 PIR센서를 이용한 구현 부분에서도 설명을 했지만 PIR 센서는 적외선 센서로 사람 몸에서 감지되는 적외선을 통해 사람의 움직임을 감지하는 센서이다. 공 모양 부분 내부에 센서가 존재하는데 각이 져있어서 굴절되는 신호를 통해 입력이 되기 때문에 약 110˚의 각도로 사람을 인식할 수 있다.
    들어오는 입력이 굴절되는 것을 보여준다.
 
 그리고 반복 트리거를 사용하여 사람이 인식이 되고 난 후에 더 이상 인식이 되지 않아도 약 3초 동안은 인식이 된 것처럼 작동을 한다. 가로등을 구현하기 위해서는 사람이 바로 지나간다고 해서 전등이 바로 꺼지면 안 되기 때문에 이 부분을 유용하게 사용할 수 있었다.
 PIR센서를 사용할 때 딱히 고려사항은 없었다. 사람이 지나가는 것을 인식하기 위한 간단한 코드로 구현이 가능했고, 0과 1값으로 구분을 할 수 있었다.


②Cds 센서(SZH-SSBH-011)

*사양
1. 허용전류: 5V 3.3V / 15㎃ 이상의 구동 능력
2. Output type: DO digital switching output (0 and 1) and AO analog voltage output

 Cds센서는 조도센서로서 빛을 받아서 저항의 값을 변하게 하는 가변저항의 일종이다. 이 저항 값이 변하는 것을 값으로 받아 조도량을 알 수 있는데 Datasheet를 보면 알 수 있듯이 저항이 클 때 조도량 lux값은 낮아지고 저항 값이 낮을 때 lux값은 커진다. 쉽게 설명하면 우리가 기본적으로 알고 있는 옴의 법칙인 V=IR에서 R(저항) 값이 작을수록 V(전압) 값은 작아진다. 비례관계이기 때문이다. 반면에 I(전류) 값은 반비례관계에 있기 때문에 R값이 작을수록 커진다. 반대로 어두울 때 R값이 커지면 V값은 커지지만 I값은 작아진다. 
 Cds센서를 사용할 때 고려할 점은 코드 상으로 adc값을 받아 실제 lux값으로 변환하려고 했지만 0~1023의 값을 받는 adc값과는 다르게 실제 조도는 0~65536 까지 있지만 우리가 사용하려는 부분은 극히 일부였다. 그래서 lux 값으로 변환을 주려는 부분에서 상당히 많은 어려움이 있었다. 하지만 많은 고찰과 실험을 통해 값을 어떻게 설정할지에 대한 부분을 해결해 나갔다.

③서보모터(SG90)

*사양
1. 허용 전압　:4.8 V (~5V) 
2. 허용 속도 :　0.1 s/60 degree
3. 온도 범위 : 0℃-55℃

 서보모터는 햇빛 가림막을 구현하기 위해서 필요한 부품이었다. 기본적으로 -90˚, 90˚, 0˚로 세 가지 각도를 통해 구현할 수 있었다. 각각 왼쪽 부분을 담당하는 서보모터는 -90˚, 오른쪽 부분을 담당하는 서보모터는 90˚으로 초기값을 설정한다. 그리고 서보모터에 변화를 줄 때(이 프로젝트에서는 조도 값이 500lux 일 때) 두 서보모터 모두 0˚로 변화를 주었다. 즉, 이러한 과정을 거치면 기존에 가림막이 걷혀져 있는 상태에서 0˚로 오게 되면서 가림막이 모이게 되고 햇빛을 가려주는 역할을 하게 된다.
 서보모터를 사용하면서 특별히 고려했던 사항은 초기값을 -90˚과 90˚로 주는 것이었다. 이 프로젝트를 구현하기 위해서는 중앙 부분인 0˚가 아닌 수직 방향으로 설정 되어 있다가 0˚가 되어야 하기 때문에 특별히 신경을 썼던 부분이다.

4. S/W 및 시나리오

![image](https://user-images.githubusercontent.com/59470033/76866864-14253a80-68a8-11ea-86ae-32577832e8a8.png)
